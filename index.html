<!DOCTYPE html>
<html>
<head>
  <title>Điều khiển bằng Giọng Nói</title>
</head>
<body>
  <h2>🎙 Điều khiển thiết bị bằng Giọng Nói</h2>
  <button onclick="startRecognition()">Bắt đầu nhận lệnh</button>
  <p id="status">⏳ Đang chờ lệnh...</p>

  <script>
    const espIp = "http://192.168.1.100"; // Thay bằng IP ESP32 của bạn

    function startRecognition() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'vi-VN';
      recognition.start();

      recognition.onresult = function(event) {
        const voiceCommand = event.results[0][0].transcript;
        document.getElementById("status").innerText = "Bạn đã nói: " + voiceCommand;
        sendCommand(voiceCommand);
      };

      recognition.onerror = function(event) {
        document.getElementById("status").innerText = "❌ Lỗi nhận diện: " + event.error;
      };
    }

    function sendCommand(cmd) {
      const url = `${espIp}/lenh?cmd=${encodeURIComponent(cmd)}`;
      fetch(url)
        .then(response => response.text())
        .then(data => {
          document.getElementById("status").innerText += "\n✅ ESP trả lời: " + data;
        })
        .catch(error => {
          document.getElementById("status").innerText += "\n⚠️ Gửi thất bại: " + error;
        });
    }
  </script>
</body>
</html>
