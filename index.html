<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Điều khiển giọng nói</title>
</head>
<body>
  <h2>🎙️ Điều khiển thiết bị bằng giọng nói</h2>
  <button onclick="startRecognition()">🎤 Bắt đầu nói</button>
  <p id="status">Chưa nói</p>

  <script>
    const ESP32_IP = "192.168.0.103"; // 👉 thay bằng IP ESP32 của bạn

    const commands = {
      "bật đèn 1": "bat den 1",
      "tắt đèn 1": "tat den 1",
      "bật đèn 2": "bat den 2",
      "tắt đèn 2": "tat den 2",
      "bật quạt": "bat quat",
      "tắt quạt": "tat quat",
      "mở máy chiếu": "mo may chieu",
      "đóng máy chiếu": "dong may chieu",
      "mở rèm": "mo rem",
      "đóng rèm": "dong rem"
    };

    function startRecognition() {
      const recognition = new webkitSpeechRecognition() || new SpeechRecognition();
      recognition.lang = "vi-VN";
      recognition.start();

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase();
        document.getElementById("status").textContent = `📢 Bạn nói: ${transcript}`;

        if (commands[transcript]) {
          const cmd = commands[transcript];
          const url = `http://${ESP32_IP}/voice?cmd=${encodeURIComponent(cmd)}`;
          fetch(url)
            .then(response => response.text())
            .then(data => {
              document.getElementById("status").textContent += `\n➡️ Lệnh gửi: ${cmd}`;
            })
            .catch(error => {
              document.getElementById("status").textContent += `\n❌ Lỗi gửi lệnh: ${error}`;
            });
        } else {
          document.getElementById("status").textContent += `\n⚠️ Không hiểu lệnh này`;
        }
      };
    }
  </script>
</body>
</html>
